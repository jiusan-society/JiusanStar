<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="_csrf" th:content="${_csrf.token}"/>
        <title>评分表编辑器</title>
        <link type="text/css" rel="stylesheet" href="../../static/vendor/bootstrap/css/bootstrap.min.css"
              th:href="@{/vendor/bootstrap/css/bootstrap.min.css}"/>
        <link type="text/css" rel="stylesheet" href="../../static/dist/css/sb-admin-2.css"
              th:href="@{/dist/css/sb-admin-2.css}"/>
        <link href="../../static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"
              th:href="@{/vendor/font-awesome/css/font-awesome.min.css}"/>
        <script type="text/javascript" src="../../static/vendor/jquery/jquery.min.js"
                th:src="@{/vendor/jquery/jquery.min.js}"></script>
        <script type="text/javascript" src="../../static/vendor/jquery/jquery.serializejson.min.js"
                th:src="@{/vendor/jquery/jquery.serializejson.min.js}"></script>
        <script type="text/javascript" src="../../static/vendor/bootstrap/js/bootstrap.min.js"
                th:src="@{/vendor/bootstrap/js/bootstrap.min.js}"></script>
    </head>
    <body>
        <div th:replace="fragments/navbar :: navbar"></div>
        <div class="container">
            <form id="sheet_form">
                <div align="center">
                    <h3><input placeholder="请输入标题" name="name"/></h3>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th style="text-align: center">指标大类</th>
                                <th style="text-align: center">指标小类</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td width="15%" rowspan="3">
                                    名称：<input type="text" name="phases[0][name]"/>
                                    最高可得：<input type="number" name="phases[0][maxScore]"/>
                                </td>
                                <td>
                                    评分标准：<textarea name="phases[0][details][0][description]"></textarea>
                                    <br/>
                                    每项可得：<input type="number" name="phases[0][details][0][eachScore]"/>
                                    <br/>
                                    最高可得：<input type="number" name="phases[0][details][0][maxScore]"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    评分标准：<textarea name="phases[0][details][1][description]"></textarea>
                                    <br/>
                                    每项可得：<input type="number" name="phases[0][details][1][eachScore]"/>
                                    <br/>
                                    最高可得：<input type="number" name="phases[0][details][1][maxScore]"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    评分标准：<textarea name="phases[0][details][2][description]"></textarea>
                                    <br/>
                                    每项可得：<input type="number" name="phases[0][details][2][eachScore]"/>
                                    <br/>
                                    最高可得：<input type="number" name="phases[0][details][2][maxScore]"/>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="4">
                                    <p align="center" class="alert alert-danger">
                                        <textarea name="description" placeholder="请输入注意事项"
                                                  style="width: 100%;"></textarea>
                                    </p>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </form>
            <div align="center">
                <input type="button" class="btn btn-primary" value="提交" onclick="submit()"/>
                <input type="reset" class="btn btn-danger" value="重置"/>
            </div>
            <script>
                const token = $("meta[name='_csrf']").attr("content");
                console.log(token);
                function submit() {
                    let sheet = $("#sheet_form").serializeJSON({
                        useIntKeysAsArrayIndex: true,
                        parseAll: true,
                        skipFalsyValuesForTypes: ["string", "null"]
                    });
                    console.log(sheet);
                    $.ajax({
                        url: "/sheet",
                        type: "post",
                        headers: {
                            'X-CSRF-Token': token,
                            'Content-Type': "application/json;charset=utf-8"
                        },
                        data: JSON.stringify(sheet),
                        dataType: "json",
                        success: function (resp) {
                            console.log(resp);
                        },
                        async: false
                    });
                }
            </script>
        </div>
    </body>
</html>